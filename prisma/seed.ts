import { PrismaClient } from "@prisma/client";
import bcrypt from "bcryptjs";

const prisma = new PrismaClient();

async function main() {
  console.log("ðŸŒ± Seeding production database...");

  const adminEmail = process.env.ADMIN_EMAIL || "admin@roboss.com";
  const adminPassword = process.env.ADMIN_PASSWORD;
  if (!adminPassword) {
    throw new Error("ADMIN_PASSWORD environment variable is required for seeding");
  }

  // ===== 1. Super Admin =====
  const passwordHash = await bcrypt.hash(adminPassword, 12);
  const admin = await prisma.user.upsert({
    where: { email: adminEmail },
    update: { passwordHash },
    create: {
      email: adminEmail,
      passwordHash,
      name: "Super Admin",
      role: "SUPER_ADMIN",
    },
  });
  console.log("âœ… Super Admin created:", admin.email);

  // ===== 2. Categories (à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸žà¸·à¹‰à¸™à¸à¸²à¸™à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸¡à¸µ) =====
  const incomeCategories = ["à¸¥à¹‰à¸²à¸‡à¸£à¸–", "à¹€à¸„à¸¥à¸·à¸­à¸šà¹à¸à¹‰à¸§", "à¸‚à¸±à¸”à¸ªà¸µ", "à¸­à¸·à¹ˆà¸™à¹†"];
  const expenseCategories = ["à¸„à¹ˆà¸²à¸™à¹‰à¸³", "à¸„à¹ˆà¸²à¹„à¸Ÿ", "à¸„à¹ˆà¸²à¹€à¸Šà¹ˆà¸²", "à¹€à¸‡à¸´à¸™à¹€à¸”à¸·à¸­à¸™", "à¸§à¸±à¸ªà¸”à¸¸à¸ªà¸´à¹‰à¸™à¹€à¸›à¸¥à¸·à¸­à¸‡", "à¸­à¸·à¹ˆà¸™à¹†"];

  for (const name of incomeCategories) {
    await prisma.category.upsert({
      where: { id: `cat-inc-${name}` },
      update: {},
      create: { id: `cat-inc-${name}`, name, type: "INCOME" },
    });
  }
  for (const name of expenseCategories) {
    await prisma.category.upsert({
      where: { id: `cat-exp-${name}` },
      update: {},
      create: { id: `cat-exp-${name}`, name, type: "EXPENSE" },
    });
  }
  console.log("âœ… Categories created");

  // ===== 3. Global Wash Packages (à¹à¸žà¹‡à¸à¹€à¸à¸ˆà¸¥à¹‰à¸²à¸‡à¸£à¸–à¸à¸¥à¸²à¸‡) =====
  const washPackages = [
    { name: "à¸¥à¹‰à¸²à¸‡à¸£à¸–à¸¢à¸™à¸•à¹Œ à¸˜à¸£à¸£à¸¡à¸”à¸²", type: "CAR", price: 80 },
    { name: "à¸¥à¹‰à¸²à¸‡à¸£à¸–à¸¢à¸™à¸•à¹Œ à¸žà¸£à¸µà¹€à¸¡à¸µà¸¢à¸¡", type: "CAR", price: 150 },
    { name: "à¹€à¸„à¸¥à¸·à¸­à¸šà¹à¸à¹‰à¸§à¸£à¸–à¸¢à¸™à¸•à¹Œ", type: "CAR", price: 350 },
    { name: "à¸¥à¹‰à¸²à¸‡à¸¡à¸­à¹€à¸•à¸­à¸£à¹Œà¹„à¸‹à¸„à¹Œ", type: "BIKE", price: 40 },
    { name: "à¸¥à¹‰à¸²à¸‡à¸¡à¸­à¹€à¸•à¸­à¸£à¹Œà¹„à¸‹à¸„à¹Œ à¸žà¸£à¸µà¹€à¸¡à¸µà¸¢à¸¡", type: "BIKE", price: 80 },
    { name: "à¸¥à¹‰à¸²à¸‡à¸«à¸¡à¸§à¸à¸à¸±à¸™à¸™à¹‡à¸­à¸„", type: "HELMET", price: 50 },
  ];

  for (const pkg of washPackages) {
    const existing = await prisma.globalWashPackage.findFirst({ where: { name: pkg.name } });
    if (!existing) {
      await prisma.globalWashPackage.create({ data: pkg });
    }
  }
  console.log("âœ… Global wash packages created");

  // ===== 4. ROI Config (singleton) =====
  const existingRoi = await prisma.roiConfig.findFirst();
  if (!existingRoi) {
    await prisma.roiConfig.create({
      data: {
        depreciationRate: 10,
        adminFeePercent: 5,
        targetRoiPercent: 25,
        targetPaybackMonths: 24,
        includePayrollInCost: true,
      },
    });
  }
  console.log("âœ… ROI config created");

  // ===== 5. SOP Documents (à¹€à¸™à¸·à¹‰à¸­à¸«à¸²à¸ˆà¸£à¸´à¸‡) =====
  const sops = [
    { title: "SOP à¸žà¸™à¸±à¸à¸‡à¸²à¸™à¸«à¸™à¹‰à¸²à¸£à¹‰à¸²à¸™", category: "STAFF", content: "# SOP à¸žà¸™à¸±à¸à¸‡à¸²à¸™à¸«à¸™à¹‰à¸²à¸£à¹‰à¸²à¸™\n\n## 1. à¸à¸²à¸£à¸•à¹‰à¸­à¸™à¸£à¸±à¸šà¸¥à¸¹à¸à¸„à¹‰à¸²\n- à¸¢à¸´à¹‰à¸¡à¸—à¸±à¸à¸—à¸²à¸¢à¸¥à¸¹à¸à¸„à¹‰à¸²à¸—à¸¸à¸à¸„à¸™\n- à¸ªà¸­à¸šà¸–à¸²à¸¡à¸šà¸£à¸´à¸à¸²à¸£à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸à¸²à¸£\n- à¹à¸™à¸°à¸™à¸³à¹à¸žà¹‡à¸à¹€à¸à¸ˆà¸—à¸µà¹ˆà¹€à¸«à¸¡à¸²à¸°à¸ªà¸¡\n\n## 2. à¸à¸²à¸£à¸£à¸±à¸šà¸£à¸–\n- à¸•à¸£à¸§à¸ˆà¸ªà¸ à¸²à¸žà¸£à¸–à¸à¹ˆà¸­à¸™à¸£à¸±à¸š\n- à¸–à¹ˆà¸²à¸¢à¸£à¸¹à¸›à¸ˆà¸¸à¸”à¸—à¸µà¹ˆà¸¡à¸µà¸£à¸­à¸¢à¸à¹ˆà¸­à¸™à¸¥à¹‰à¸²à¸‡\n- à¹à¸ˆà¹‰à¸‡à¸¥à¸¹à¸à¸„à¹‰à¸²à¸«à¸²à¸à¸žà¸šà¸„à¸§à¸²à¸¡à¹€à¸ªà¸µà¸¢à¸«à¸²à¸¢\n\n## 3. à¸à¸²à¸£à¸ªà¹ˆà¸‡à¸¡à¸­à¸šà¸£à¸–\n- à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸„à¸§à¸²à¸¡à¸ªà¸°à¸­à¸²à¸”\n- à¹€à¸Šà¹‡à¸”à¸£à¸–à¹ƒà¸«à¹‰à¹à¸«à¹‰à¸‡\n- à¹€à¸£à¸µà¸¢à¸à¸¥à¸¹à¸à¸„à¹‰à¸²à¸¡à¸²à¸£à¸±à¸šà¸£à¸–" },
    { title: "SOP à¸¥à¹‰à¸²à¸‡à¸£à¸–à¸¢à¸™à¸•à¹Œ", category: "WASH_CAR", content: "# SOP à¸¥à¹‰à¸²à¸‡à¸£à¸–à¸¢à¸™à¸•à¹Œ\n\n## à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™\n1. à¸‰à¸µà¸”à¸™à¹‰à¸³à¸¥à¹‰à¸²à¸‡à¸„à¸£à¸²à¸šà¸ªà¸à¸›à¸£à¸à¹€à¸šà¸·à¹‰à¸­à¸‡à¸•à¹‰à¸™\n2. à¸‰à¸µà¸”à¹‚à¸Ÿà¸¡à¸—à¸±à¹ˆà¸§à¸„à¸±à¸™\n3. à¹ƒà¸Šà¹‰à¸–à¸¸à¸‡à¸¡à¸·à¸­à¸¥à¹‰à¸²à¸‡à¸ˆà¸²à¸à¸šà¸™à¸¥à¸‡à¸¥à¹ˆà¸²à¸‡\n4. à¸‰à¸µà¸”à¸™à¹‰à¸³à¸¥à¹‰à¸²à¸‡à¹‚à¸Ÿà¸¡à¸­à¸­à¸\n5. à¹€à¸›à¹ˆà¸²à¸¥à¸¡à¹„à¸¥à¹ˆà¸™à¹‰à¸³\n6. à¹€à¸Šà¹‡à¸”à¸”à¹‰à¸§à¸¢à¸œà¹‰à¸²à¹„à¸¡à¹‚à¸„à¸£à¹„à¸Ÿà¹€à¸šà¸­à¸£à¹Œ\n\n## à¸‚à¹‰à¸­à¸„à¸§à¸£à¸£à¸°à¸§à¸±à¸‡\n- à¸«à¹‰à¸²à¸¡à¹ƒà¸Šà¹‰à¸Ÿà¸­à¸‡à¸™à¹‰à¸³à¸—à¸µà¹ˆà¸•à¸à¸žà¸·à¹‰à¸™\n- à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸™à¹‰à¸³à¹ƒà¸™à¸–à¸±à¸‡à¸—à¸¸à¸ 5 à¸„à¸±à¸™" },
    { title: "SOP à¸¥à¹‰à¸²à¸‡à¸¡à¸­à¹€à¸•à¸­à¸£à¹Œà¹„à¸‹à¸„à¹Œ", category: "WASH_BIKE", content: "# SOP à¸¥à¹‰à¸²à¸‡à¸¡à¸­à¹€à¸•à¸­à¸£à¹Œà¹„à¸‹à¸„à¹Œ\n\n## à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™\n1. à¸›à¸´à¸”à¸à¸²à¸–à¸±à¸‡à¸™à¹‰à¸³à¸¡à¸±à¸™\n2. à¸‰à¸µà¸”à¸™à¹‰à¸³à¹€à¸šà¸²à¹† à¸«à¸¥à¸µà¸à¹€à¸¥à¸µà¹ˆà¸¢à¸‡à¸Šà¸´à¹‰à¸™à¸ªà¹ˆà¸§à¸™à¹„à¸Ÿà¸Ÿà¹‰à¸²\n3. à¹ƒà¸Šà¹‰à¹à¸›à¸£à¸‡à¸‚à¸™à¸­à¹ˆà¸­à¸™à¸—à¸³à¸„à¸§à¸²à¸¡à¸ªà¸°à¸­à¸²à¸”\n4. à¸‰à¸µà¸”à¸™à¹‰à¸³à¸¥à¹‰à¸²à¸‡\n5. à¹€à¸›à¹ˆà¸²à¸¥à¸¡à¹„à¸¥à¹ˆà¸™à¹‰à¸³\n6. à¹€à¸Šà¹‡à¸”à¹ƒà¸«à¹‰à¹à¸«à¹‰à¸‡" },
    { title: "SOP à¹€à¸›à¸´à¸”-à¸›à¸´à¸”à¸£à¹‰à¸²à¸™", category: "OPEN_CLOSE", content: "# SOP à¹€à¸›à¸´à¸”-à¸›à¸´à¸”à¸£à¹‰à¸²à¸™\n\n## à¹€à¸›à¸´à¸”à¸£à¹‰à¸²à¸™ (07:30)\n1. à¹€à¸›à¸´à¸”à¹„à¸Ÿ-à¸™à¹‰à¸³-à¸›à¸±à¹Šà¸¡\n2. à¸•à¸£à¸§à¸ˆà¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸—à¸¸à¸à¸ˆà¸¸à¸”\n3. à¹€à¸•à¸´à¸¡à¸™à¹‰à¸³à¸¢à¸²\n4. à¸—à¸³à¸„à¸§à¸²à¸¡à¸ªà¸°à¸­à¸²à¸”à¸žà¸·à¹‰à¸™à¸—à¸µà¹ˆ\n\n## à¸›à¸´à¸”à¸£à¹‰à¸²à¸™ (19:00)\n1. à¸¥à¹‰à¸²à¸‡à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸¡à¸·à¸­\n2. à¸›à¸´à¸”à¸™à¹‰à¸³-à¸›à¸±à¹Šà¸¡\n3. à¹€à¸à¹‡à¸šà¸­à¸¸à¸›à¸à¸£à¸“à¹Œ\n4. à¸›à¸´à¸”à¹„à¸Ÿ-à¸¥à¹‡à¸­à¸„à¸£à¹‰à¸²à¸™\n5. à¸ªà¹ˆà¸‡à¸¢à¸­à¸”à¸›à¸£à¸°à¸ˆà¸³à¸§à¸±à¸™" },
    { title: "SOP à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢", category: "SAFETY", content: "# SOP à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢\n\n## à¸­à¸¸à¸›à¸à¸£à¸“à¹Œà¸›à¹‰à¸­à¸‡à¸à¸±à¸™\n- à¸ªà¸§à¸¡à¸£à¸­à¸‡à¹€à¸—à¹‰à¸²à¸à¸±à¸™à¸¥à¸·à¹ˆà¸™\n- à¸ªà¸§à¸¡à¸–à¸¸à¸‡à¸¡à¸·à¸­à¸¢à¸²à¸‡\n- à¸ªà¸§à¸¡à¹à¸§à¹ˆà¸™à¸à¸±à¸™à¸™à¹‰à¸³ (à¸à¸£à¸“à¸µà¹ƒà¸Šà¹‰à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸‰à¸µà¸”à¹à¸£à¸‡à¸”à¸±à¸™à¸ªà¸¹à¸‡)\n\n## à¸à¸£à¸“à¸µà¸‰à¸¸à¸à¹€à¸‰à¸´à¸™\n- à¹„à¸Ÿà¸Ÿà¹‰à¸²à¸¥à¸±à¸”à¸§à¸‡à¸ˆà¸£: à¸•à¸±à¸”à¹„à¸Ÿà¸—à¸µà¹ˆà¹€à¸šà¸£à¸à¹€à¸à¸­à¸£à¹Œ\n- à¸™à¹‰à¸³à¸£à¸±à¹ˆà¸§: à¸›à¸´à¸”à¸§à¸²à¸¥à¹Œà¸§à¸«à¸¥à¸±à¸\n- à¸­à¸¸à¸šà¸±à¸•à¸´à¹€à¸«à¸•à¸¸: à¹‚à¸—à¸£ 1669" },
    { title: "SOP à¹à¸à¹‰à¸›à¸±à¸à¸«à¸²à¹€à¸šà¸·à¹‰à¸­à¸‡à¸•à¹‰à¸™", category: "TROUBLESHOOT", content: "# SOP à¹à¸à¹‰à¸›à¸±à¸à¸«à¸²à¹€à¸šà¸·à¹‰à¸­à¸‡à¸•à¹‰à¸™\n\n## à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¹„à¸¡à¹ˆà¸—à¸³à¸‡à¸²à¸™\n1. à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¹„à¸Ÿà¹€à¸‚à¹‰à¸²\n2. à¸•à¸£à¸§à¸ˆà¹€à¸šà¸£à¸à¹€à¸à¸­à¸£à¹Œ\n3. à¸£à¸µà¸ªà¸•à¸²à¸£à¹Œà¸—à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡\n4. à¹à¸ˆà¹‰à¸‡à¸Šà¹ˆà¸²à¸‡à¸«à¸²à¸à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸—à¸³à¸‡à¸²à¸™\n\n## à¸™à¹‰à¸³à¹„à¸¡à¹ˆà¸­à¸­à¸\n1. à¸•à¸£à¸§à¸ˆà¸§à¸²à¸¥à¹Œà¸§à¸™à¹‰à¸³\n2. à¸•à¸£à¸§à¸ˆà¸›à¸±à¹Šà¸¡\n3. à¸•à¸£à¸§à¸ˆà¸—à¹ˆà¸­à¸™à¹‰à¸³" },
  ];
  for (const sop of sops) {
    const existing = await prisma.sopDocument.findFirst({ where: { title: sop.title } });
    if (!existing) {
      await prisma.sopDocument.create({
        data: { ...sop, createdById: admin.id, sortOrder: sops.indexOf(sop) },
      });
    }
  }
  console.log("âœ… SOP documents created");

  // ===== 6. Machine Manuals (à¸„à¸¹à¹ˆà¸¡à¸·à¸­à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸ˆà¸£à¸´à¸‡) =====
  const manuals = [
    {
      title: "à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸‰à¸µà¸”à¸™à¹‰à¸³à¹à¸£à¸‡à¸”à¸±à¸™à¸ªà¸¹à¸‡ Karcher HD 5/15",
      machineModel: "Karcher HD 5/15",
      content: "# à¸„à¸¹à¹ˆà¸¡à¸·à¸­à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡ Karcher HD 5/15\n\n## à¸ªà¹€à¸›à¸„\n- à¹à¸£à¸‡à¸”à¸±à¸™: 150 bar\n- à¸­à¸±à¸•à¸£à¸²à¸™à¹‰à¸³: 500 l/h\n- à¸à¸³à¸¥à¸±à¸‡à¹„à¸Ÿ: 2.8 kW\n\n## à¸à¸²à¸£à¹ƒà¸Šà¹‰à¸‡à¸²à¸™\n1. à¸•à¹ˆà¸­à¸ªà¸²à¸¢à¸™à¹‰à¸³à¹€à¸‚à¹‰à¸²\n2. à¹€à¸ªà¸µà¸¢à¸šà¸›à¸¥à¸±à¹Šà¸\n3. à¹€à¸›à¸´à¸”à¸§à¸²à¸¥à¹Œà¸§à¸™à¹‰à¸³\n4. à¸à¸”à¸ªà¸§à¸´à¸•à¸Šà¹Œà¹€à¸›à¸´à¸”\n5. à¸šà¸µà¸šà¹„à¸à¸›à¸·à¸™à¸‰à¸µà¸”",
      videoUrl: null,
      checklist: JSON.stringify(["à¸•à¸£à¸§à¸ˆà¸ªà¸²à¸¢à¸™à¹‰à¸³", "à¸•à¸£à¸§à¸ˆà¸«à¸±à¸§à¸‰à¸µà¸”", "à¸•à¸£à¸§à¸ˆà¸™à¹‰à¸³à¸¡à¸±à¸™à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡", "à¸—à¸³à¸„à¸§à¸²à¸¡à¸ªà¸°à¸­à¸²à¸”à¸Ÿà¸´à¸¥à¹€à¸•à¸­à¸£à¹Œ", "à¸•à¸£à¸§à¸ˆà¸ªà¸²à¸¢à¹„à¸Ÿ"]),
    },
    {
      title: "à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸”à¸¹à¸”à¸à¸¸à¹ˆà¸™ Roboss V200",
      machineModel: "Roboss V200",
      content: "# à¸„à¸¹à¹ˆà¸¡à¸·à¸­à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡ Roboss V200\n\n## à¸ªà¹€à¸›à¸„\n- à¸à¸³à¸¥à¸±à¸‡à¸”à¸¹à¸”: 200W\n- à¸–à¸±à¸‡à¹€à¸à¹‡à¸š: 20L\n\n## à¸à¸²à¸£à¹ƒà¸Šà¹‰à¸‡à¸²à¸™\n1. à¸•à¸£à¸§à¸ˆà¸–à¸¸à¸‡à¹€à¸à¹‡à¸šà¸à¸¸à¹ˆà¸™\n2. à¹€à¸ªà¸µà¸¢à¸šà¸›à¸¥à¸±à¹Šà¸\n3. à¹€à¸›à¸´à¸”à¸ªà¸§à¸´à¸•à¸Šà¹Œ\n4. à¸”à¸¹à¸”à¸à¸¸à¹ˆà¸™à¸•à¸²à¸¡à¸žà¸·à¹‰à¸™à¸—à¸µà¹ˆ",
      videoUrl: null,
      checklist: JSON.stringify(["à¸•à¸£à¸§à¸ˆà¸–à¸¸à¸‡à¹€à¸à¹‡à¸šà¸à¸¸à¹ˆà¸™", "à¸—à¸³à¸„à¸§à¸²à¸¡à¸ªà¸°à¸­à¸²à¸”à¸Ÿà¸´à¸¥à¹€à¸•à¸­à¸£à¹Œ", "à¸•à¸£à¸§à¸ˆà¸ªà¸²à¸¢à¹„à¸Ÿ", "à¹€à¸—à¸–à¸±à¸‡à¹€à¸à¹‡à¸š"]),
    },
  ];
  for (const manual of manuals) {
    const existing = await prisma.machineManual.findFirst({ where: { machineModel: manual.machineModel } });
    if (!existing) {
      await prisma.machineManual.create({ data: { ...manual, createdById: admin.id } });
    }
  }
  console.log("âœ… Machine manuals created");

  // ===== 7. Site Config (default) =====
  const existingSiteConfig = await prisma.siteConfig.findFirst();
  if (!existingSiteConfig) {
    await prisma.siteConfig.create({
      data: { brandName: "Roboss" },
    });
  }
  console.log("âœ… Site config created");

  console.log("\nðŸŽ‰ Production seeding complete!");
  console.log("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
  console.log(`Super Admin: ${adminEmail}`);
  console.log("à¸ªà¸£à¹‰à¸²à¸‡à¸ªà¸²à¸‚à¸²à¹à¸¥à¸°à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸­à¸·à¹ˆà¸™à¹† à¸œà¹ˆà¸²à¸™à¸«à¸™à¹‰à¸² Admin UI");
  console.log("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
}

main()
  .catch((e) => {
    console.error(e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });
